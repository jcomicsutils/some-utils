<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Text Pattern Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;700&family=Inter:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap');
        
        .font-perpetua-class {
            font-family: "Perpetua Titling MT", "Copperplate Gothic Bold", 'Crimson Pro', serif;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }

        #canvas-output {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-radius: 0.5rem;
            background-color: white;
            transition: transform 0.3s ease;
        }

        #canvas-output:hover {
            transform: scale(1.01);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto bg-white shadow-xl rounded-xl p-6 lg:p-10 border border-gray-100">
        <h1 class="text-3xl font-bold mb-6 text-gray-800 font-perpetua-class">Random Text Pattern Generator</h1>
        <p class="mb-6 text-sm text-gray-600">Enter your phrases, set your canvas dimensions, and customize the text style to generate a dynamically filled pattern.</p>

        <div class="grid lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 space-y-4 bg-gray-50 p-4 rounded-lg shadow-inner border border-gray-200">
                <h2 class="text-xl font-semibold mb-3 text-gray-700">Settings</h2>

                <div>
                    <label for="phrases" class="block text-sm font-medium text-gray-700 mb-1">Phrases (One per line):</label>
                    <textarea id="phrases" rows="5" class="w-full border-gray-300 border rounded-lg shadow-sm p-2 text-sm focus:ring-blue-500 focus:border-blue-500">Piorou
Vai piorar
A qualquer hora piora</textarea>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="canvas-width" class="block text-sm font-medium text-gray-700 mb-1">Canvas Width (px):</label>
                        <input type="number" id="canvas-width" value="800" class="w-full border-gray-300 border rounded-lg shadow-sm p-2 text-sm">
                    </div>
                    <div>
                        <label for="canvas-height" class="block text-sm font-medium text-gray-700 mb-1">Canvas Height (px):</label>
                        <input type="number" id="canvas-height" value="600" class="w-full border-gray-300 border rounded-lg shadow-sm p-2 text-sm">
                    </div>
                </div>

                <div>
                    <label for="font-select" class="block text-sm font-medium text-gray-700 mb-1">Font Family:</label>
                    <select id="font-select" class="w-full border-gray-300 border rounded-lg shadow-sm p-2 text-sm focus:ring-blue-500 focus:border-blue-500">
                        <!-- Options will be added here by JavaScript -->
                    </select>
                </div>
                
                 <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="font-size" class="block text-sm font-medium text-gray-700 mb-1">Font Size (px):</label>
                        <input type="number" id="font-size" value="28" class="w-full border-gray-300 border rounded-lg shadow-sm p-2 text-sm">
                    </div>
                </div>


                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="h-spacing" class="block text-sm font-medium text-gray-700 mb-1">Horizontal Spacing (px):</label>
                        <input type="number" id="h-spacing" value="15" class="w-full border-gray-300 border rounded-lg shadow-sm p-2 text-sm">
                    </div>
                    <div>
                        <label for="v-spacing" class="block text-sm font-medium text-gray-700 mb-1">Vertical Spacing (px):</label>
                        <input type="number" id="v-spacing" value="10" class="w-full border-gray-300 border rounded-lg shadow-sm p-2 text-sm">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="text-color" class="block text-sm font-medium text-gray-700 mb-1">Text Color:</label>
                        <input type="color" id="text-color" value="#1f2937" class="w-full h-10 border-gray-300 border rounded-lg shadow-sm p-1">
                    </div>
                    <div>
                        <label for="bg-color" class="block text-sm font-medium text-gray-700 mb-1">Background Color:</label>
                        <input type="color" id="bg-color" value="#FFFFFF" class="w-full h-10 border-gray-300 border rounded-lg shadow-sm p-1">
                    </div>
                    <div>
                        <label for="bg-opacity" class="block text-sm font-medium text-gray-700 mb-1">BG Opacity (0-1):</label>
                        <input type="number" id="bg-opacity" step="0.05" min="0" max="1" value="1" class="w-full border-gray-300 border rounded-lg shadow-sm p-2 text-sm">
                    </div>
                </div>
                
                <div class="flex items-center space-x-2 pt-2">
                    <input type="checkbox" id="allow-overflow" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="allow-overflow" class="text-sm font-medium text-gray-700">Allow Text Overflow (Full Edge-to-Edge Fill)</label>
                </div>

                <button onclick="generatePattern()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
                    Generate Pattern
                </button>
                <a id="download-link" download="random_text_pattern.png" class="hidden w-full text-center bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
                    Download Image
                </a>
            </div>

            <div class="lg:col-span-2 flex justify-center items-center p-4 bg-gray-100 rounded-lg border border-gray-300 overflow-x-hidden">
                <canvas id="canvas-output" class="max-w-full h-auto"></canvas>
            </div>
        </div>
    </div>

    <script>
        function hexToRgb(hex) {
            const bigint = parseInt(hex.slice(1), 16);
            const r = (bigint >> 16) & 255;
            const g = (bigint >> 8) & 255;
            const b = bigint & 255;
            return { r, g, b };
        }

        function populateFontDropdown() {
            let fontOptions = [
                { name: "Perpetua Titling MT (Original)", stack: '"Perpetua Titling MT", "Copperplate Gothic Bold", "Crimson Pro", serif' },
                { name: "Arial (System)", stack: "Arial, sans-serif" },
                { name: "Times New Roman (System)", stack: "'Times New Roman', Times, serif" },
                { name: "Courier New (System)", stack: "'Courier New', Courier, monospace" }
            ];

            try {
                for (const sheet of document.styleSheets) {
                    if (!sheet.cssRules) continue;
                    
                    for (const rule of sheet.cssRules) {
                        if (rule.type === CSSRule.IMPORT_RULE && rule.href && rule.href.includes('fonts.googleapis.com')) {
                            const url = new URL(rule.href);
                            const families = url.searchParams.getAll('family');
                            
                            for (const family of families) {
                                const fontName = family.split(':')[0].replace(/\+/g, ' '); 
                                
                                let fallback = "sans-serif"; 
                                if (fontName.includes("Mono")) fallback = "monospace";
                                else if (fontName.includes("Serif") || fontName.includes("Pro")) fallback = "serif";
                                
                                const stack = `'${fontName}', ${fallback}`;
                                
                                if (!fontOptions.some(f => f.name.startsWith(fontName))) {
                                    fontOptions.push({ name: `${fontName} (Web)`, stack: stack });
                                }
                            }
                        }
                    }
                }
            } catch (e) {
                console.warn("Could not fully parse stylesheets for fonts, using defaults.", e.message);
            }

            const fontSelect = document.getElementById('font-select');
            fontSelect.innerHTML = ''; 
            
            fontOptions.forEach(font => {
                const option = document.createElement('option');
                option.value = font.stack; 
                option.textContent = font.name;
                fontSelect.appendChild(option);
            });
        }


        function generatePattern() {
            const canvas = document.getElementById('canvas-output');
            const ctx = canvas.getContext('2d');
            
            const phrasesInput = document.getElementById('phrases').value;
            const phrases = phrasesInput.split('\n').map(p => p.trim()).filter(p => p.length > 0);
            
            if (phrases.length === 0) {
                console.error("Please enter at least one phrase.");
                showStatusMessage("Error: Please enter at least one phrase.", 'error');
                return;
            }

            const canvasWidth = parseInt(document.getElementById('canvas-width').value) || 800;
            const canvasHeight = parseInt(document.getElementById('canvas-height').value) || 600;
            const fontSize = parseInt(document.getElementById('font-size').value) || 28;
            const textColor = document.getElementById('text-color').value || '#1f2937';
            const bgColorHex = document.getElementById('bg-color').value || '#FFFFFF';
            const bgOpacity = parseFloat(document.getElementById('bg-opacity').value) || 1;
            const allowOverflow = document.getElementById('allow-overflow').checked;

            const hSpacing = parseInt(document.getElementById('h-spacing').value) || 15;
            const vSpacing = parseInt(document.getElementById('v-spacing').value) || 10;
            
            const fontStack = document.getElementById('font-select').value;
            
            if (!fontStack) {
                console.error("No font selected or font list empty.");
                showStatusMessage("Error: Font list is empty.", 'error');
                return;
            }

            canvas.width = canvasWidth;
            canvas.height = canvasHeight;

            ctx.font = `${fontSize}px ${fontStack}`;
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';

            if (bgOpacity < 1) {
                const rgb = hexToRgb(bgColorHex);
                ctx.fillStyle = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${bgOpacity})`;
            } else {
                ctx.fillStyle = bgColorHex;
            }
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            ctx.fillStyle = textColor;


            const standardLineHeight = fontSize * 1.5;
            const padding = 10; 
            
            let x = padding;
            let y = padding + fontSize; 
            
            let maxX = allowOverflow ? canvasWidth + 200 : canvasWidth - padding;

            while (y < canvasHeight - padding) {
                while (x < maxX) { 
                    const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
                    const metrics = ctx.measureText(randomPhrase);
                    const phraseWidth = metrics.width;

                    if (!allowOverflow && x + phraseWidth + hSpacing + padding > canvasWidth) {
                        break; 
                    }

                    const randomXShift = Math.random() * 5 - 2.5; 
                    const randomYShift = Math.random() * 3 - 1.5; 

                    ctx.save();
                    ctx.translate(x + randomXShift, y + randomYShift);
                    ctx.fillText(randomPhrase, 0, 0);
                    ctx.restore();

                    const currentSpacing = hSpacing + (Math.random() * 10 - 5); 
                    x += phraseWidth + currentSpacing;
                }
                
                x = padding;
                const lineJump = standardLineHeight + vSpacing + (Math.random() * 5); 
                y += lineJump;
            }

            updateDownloadLink();
            showStatusMessage("Pattern generated successfully! Ready to download.", 'success');
        }

        function updateDownloadLink() {
            const canvas = document.getElementById('canvas-output');
            const downloadLink = document.getElementById('download-link');
            
            const dataURL = canvas.toDataURL('image/png');
            downloadLink.href = dataURL;
            downloadLink.classList.remove('hidden');
        }

        function showStatusMessage(message, type) {
            const container = document.querySelector('.lg\\:col-span-1');
            let messageBox = document.getElementById('status-message');

            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'status-message';
                messageBox.className = 'p-3 rounded-lg text-sm transition-opacity duration-300 mb-4';
                container.prepend(messageBox);
            }

            messageBox.textContent = message;
            messageBox.style.opacity = '1';

            if (type === 'error') {
                messageBox.className = 'p-3 rounded-lg text-sm mb-4 bg-red-100 text-red-800 border border-red-300';
            } else {
                messageBox.className = 'p-3 rounded-lg text-sm mb-4 bg-blue-100 text-blue-800 border border-blue-300';
            }
            
            setTimeout(() => {
                messageBox.style.opacity = '0';
            }, 5000);
        }

        window.onload = function() {
            const canvas = document.getElementById('canvas-output');
            canvas.width = 1000;
            canvas.height = 1000;

            populateFontDropdown();
            
            generatePattern();
        }

    </script>
</body>
</html>